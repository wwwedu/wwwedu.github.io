<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dragos Ailoae">
<meta name="dcterms.date" content="2026-01-22">

<title>Seemingly Unrelated Regression (SUR)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="test_files/libs/clipboard/clipboard.min.js"></script>
<script src="test_files/libs/quarto-html/quarto.js"></script>
<script src="test_files/libs/quarto-html/popper.min.js"></script>
<script src="test_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="test_files/libs/quarto-html/anchor.min.js"></script>
<link href="test_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="test_files/libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="test_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="test_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="test_files/libs/bootstrap/bootstrap-efb6f74f27b47c755890f838f82c0cc0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#intro-the-grunfeld-dataset" id="toc-intro-the-grunfeld-dataset" class="nav-link active" data-scroll-target="#intro-the-grunfeld-dataset"><span class="header-section-number">1</span> Intro: The Grunfeld dataset</a></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data"><span class="header-section-number">2</span> Loading the data</a></li>
  <li><a href="#equation-by-equation-estimation-using-the-lm-function" id="toc-equation-by-equation-estimation-using-the-lm-function" class="nav-link" data-scroll-target="#equation-by-equation-estimation-using-the-lm-function"><span class="header-section-number">3</span> Equation by equation estimation using the <em>lm()</em> function</a></li>
  <li><a href="#sur-motivation-contemporaneously-correlated-disturbances" id="toc-sur-motivation-contemporaneously-correlated-disturbances" class="nav-link" data-scroll-target="#sur-motivation-contemporaneously-correlated-disturbances"><span class="header-section-number">4</span> SUR motivation: contemporaneously correlated disturbances</a></li>
  <li><a href="#r-packages-for-panel-data-analysis-plm-and-systemfit" id="toc-r-packages-for-panel-data-analysis-plm-and-systemfit" class="nav-link" data-scroll-target="#r-packages-for-panel-data-analysis-plm-and-systemfit"><span class="header-section-number">5</span> R packages for panel data analysis: PLM and SYSTEMFIT</a>
  <ul class="collapse">
  <li><a href="#configuring-data-as-a-panel" id="toc-configuring-data-as-a-panel" class="nav-link" data-scroll-target="#configuring-data-as-a-panel"><span class="header-section-number">5.1</span> Configuring data as a panel</a></li>
  </ul></li>
  <li><a href="#alternatives-to-lm-for-equation-by-equation-estimation" id="toc-alternatives-to-lm-for-equation-by-equation-estimation" class="nav-link" data-scroll-target="#alternatives-to-lm-for-equation-by-equation-estimation"><span class="header-section-number">6</span> Alternatives to <em>lm()</em> for equation by equation estimation</a></li>
  <li><a href="#checking-residuals-covariance-matrix" id="toc-checking-residuals-covariance-matrix" class="nav-link" data-scroll-target="#checking-residuals-covariance-matrix"><span class="header-section-number">7</span> Checking residuals covariance matrix</a></li>
  <li><a href="#tests-for-cross-sectional-dependence" id="toc-tests-for-cross-sectional-dependence" class="nav-link" data-scroll-target="#tests-for-cross-sectional-dependence"><span class="header-section-number">8</span> Tests for cross-sectional dependence</a></li>
  <li><a href="#estimating-the-sur-model" id="toc-estimating-the-sur-model" class="nav-link" data-scroll-target="#estimating-the-sur-model"><span class="header-section-number">9</span> Estimating the SUR model</a></li>
  <li><a href="#testing-the-homogeneous-coefficients-hypothesis" id="toc-testing-the-homogeneous-coefficients-hypothesis" class="nav-link" data-scroll-target="#testing-the-homogeneous-coefficients-hypothesis"><span class="header-section-number">10</span> Testing the “homogeneous coefficients” hypothesis</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Seemingly Unrelated Regression (SUR)</h1>
<p class="subtitle lead">Some Examples</p>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dragos Ailoae </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 22, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="intro-the-grunfeld-dataset" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="intro-the-grunfeld-dataset"><span class="header-section-number">1</span> Intro: The Grunfeld dataset</h2>
<p>To illustrate the basics of SUR analysis with R we will use a subset of the Grunfeld dataset. This is the data made famous by Arnold Zellner with his classic 1962 paper on seemingly unrelated regressions. Grunfeld originally used the dataset in his 1958 PhD thesis <em>The determinants of corporate investment.</em> at the University of Chicago.</p>
<p>Our subset includes just two firms, US (US Steel) and DM (Diamond Match) observed over the period 1935 to 1954. The problem is to find the determinants of investment by a firm, <span class="math inline">\(i n v_{i t}\)</span> among regressors such as the value of the firm, <span class="math inline">\(v_{i t}\)</span>, and capital stock <span class="math inline">\(k_{i t}\)</span>.</p>
<p>The Grunfeld Investment model is as follows: <span class="math display">\[
inv_{i t}=\beta_{0 i}+\beta_{1 i} v_{i t}+\beta_{2 i} k_{i t}+\epsilon_{i t}
\]</span></p>
<p>where</p>
<p><span class="math inline">\(\begin{aligned}
{inv}_{{i t}}&amp;= \text {gross investment for firm } {i} \text { at time } {t} \\
{v}_{{i t}}&amp;=\text { market value of firm } {i} \text { at } {t} \\
{k}_{{i t}} &amp;=\text { capital stock of firm } {i} \text { at } {t} .
\end{aligned}\)</span></p>
<p>If you’d like to play with the full dataset you can access it <a href="http://www.stern.nyu.edu/~wgreene/Text/Edition7/TableF10-4.csv">here</a> or <a href="https://www.zeileis.org/grunfeld/Grunfeld.csv">here</a>. More on this dataset <a href="https://www.zeileis.org/grunfeld/">here</a></p>
</section>
<section id="loading-the-data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="loading-the-data"><span class="header-section-number">2</span> Loading the data</h2>
<p>Let’s begin by loading some necessary packages and the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())    <span class="co"># Removes all items in Environment!</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width =</span> <span class="dv">6</span>, <span class="at">repr.plot.height =</span> <span class="dv">6</span>,<span class="at">repr.plot.res =</span> <span class="dv">150</span>, <span class="at">warn=</span><span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># LOAD PACKAGES:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"plm"</span>,<span class="st">"systemfit"</span>,<span class="st">"modelsummary"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop though vector and load respective packages:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>zzz <span class="ot">&lt;-</span> <span class="fu">lapply</span>(packages, <span class="cf">function</span>(xxx) <span class="fu">suppressMessages</span>(<span class="fu">require</span>(xxx, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)))  <span class="co"># quiet no warnings</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#zzz &lt;- lapply(packages, require, character.only = TRUE) # verbose with warnings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>my.raw.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(<span class="st">"https://wwwedu.github.io/NYU_S25/Lecture02/grun_data.csv"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>my.raw.data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   firm year    inv     val    cap
1    US 1935 209.90 1362.40  53.80
2    US 1936 355.30 1807.10  50.50
3    US 1937 469.90 2676.30 118.10
4    US 1938 262.30 1801.90 260.20
5    US 1939 230.40 1957.30 312.70
6    US 1940 361.60 2202.90 254.20
7    US 1941 472.80 2380.50 261.40
8    US 1942 445.60 2168.60 298.70
9    US 1943 361.60 1985.10 301.80
10   US 1944 288.20 1813.90 279.10
11   US 1945 258.70 1850.20 213.80
12   US 1946 420.30 2067.70 132.60
13   US 1947 420.50 1796.70 264.80
14   US 1948 494.50 1625.80 306.90
15   US 1949 405.10 1667.00 351.10
16   US 1950 418.80 1677.40 357.80
17   US 1951 588.20 2289.50 342.10
18   US 1952 645.50 2159.40 444.20
19   US 1953 641.00 2031.30 623.60
20   US 1954 459.30 2115.50 669.70
21   DM 1935   2.54   70.91   4.50
22   DM 1936   2.00   87.94   4.71
23   DM 1937   2.19   82.20   4.57
24   DM 1938   1.99   58.72   4.56
25   DM 1939   2.03   80.54   4.38
26   DM 1940   1.81   86.47   4.21
27   DM 1941   2.14   77.68   4.12
28   DM 1942   1.86   62.16   3.83
29   DM 1943   0.93   62.24   3.58
30   DM 1944   1.18   61.82   3.41
31   DM 1945   1.36   65.85   3.31
32   DM 1946   2.24   69.54   3.23
33   DM 1947   3.81   64.97   3.90
34   DM 1948   5.66   68.00   5.38
35   DM 1949   4.21   71.24   7.39
36   DM 1950   3.42   69.05   8.74
37   DM 1951   4.67   83.04   9.07
38   DM 1952   6.00   74.42   9.93
39   DM 1953   6.53   63.51  11.68
40   DM 1954   5.12   58.12  14.33</code></pre>
</div>
</div>
</section>
<section id="equation-by-equation-estimation-using-the-lm-function" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="equation-by-equation-estimation-using-the-lm-function"><span class="header-section-number">3</span> Equation by equation estimation using the <em>lm()</em> function</h2>
<p>As a first step, we may want to fit the data for each firm using our old friend the lm() function. So let’s break up the dataset into two separate subsets, one for Diamond Match and another for US Steel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>US.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(my.raw.data,firm<span class="sc">==</span><span class="st">"US"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(US.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  firm year   inv    val   cap
1   US 1935 209.9 1362.4  53.8
2   US 1936 355.3 1807.1  50.5
3   US 1937 469.9 2676.3 118.1
4   US 1938 262.3 1801.9 260.2
5   US 1939 230.4 1957.3 312.7
6   US 1940 361.6 2202.9 254.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>DM.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(my.raw.data,firm<span class="sc">==</span><span class="st">"DM"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DM.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   firm year  inv   val  cap
21   DM 1935 2.54 70.91 4.50
22   DM 1936 2.00 87.94 4.71
23   DM 1937 2.19 82.20 4.57
24   DM 1938 1.99 58.72 4.56
25   DM 1939 2.03 80.54 4.38
26   DM 1940 1.81 86.47 4.21</code></pre>
</div>
</div>
<p>We can now fit the US Steel data using lm():</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lm.US <span class="ot">&lt;-</span> <span class="fu">lm</span>(inv <span class="sc">~</span> val <span class="sc">+</span> cap, US.data)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.US)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = inv ~ val + cap, data = US.data)

Residuals:
     Min       1Q   Median       3Q      Max 
-184.488  -77.210    4.508   59.421  144.035 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) -49.1983   148.0754  -0.332   0.7438  
val           0.1749     0.0742   2.357   0.0307 *
cap           0.3896     0.1424   2.737   0.0140 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 96.43 on 17 degrees of freedom
Multiple R-squared:  0.4709,    Adjusted R-squared:  0.4086 
F-statistic: 7.564 on 2 and 17 DF,  p-value: 0.00447</code></pre>
</div>
</div>
<p>And similarly for Diamond Match:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lm.DM <span class="ot">&lt;-</span> <span class="fu">lm</span>(inv <span class="sc">~</span> val <span class="sc">+</span> cap, DM.data)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.DM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = inv ~ val + cap, data = DM.data)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.5748 -0.5972 -0.3036  0.3834  2.8344 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.161519   2.065564   0.078    0.939    
val         0.004573   0.027161   0.168    0.868    
cap         0.437369   0.079589   5.495 3.94e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.085 on 17 degrees of freedom
Multiple R-squared:  0.6432,    Adjusted R-squared:  0.6012 
F-statistic: 15.32 on 2 and 17 DF,  p-value: 0.0001571</code></pre>
</div>
</div>
</section>
<section id="sur-motivation-contemporaneously-correlated-disturbances" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="sur-motivation-contemporaneously-correlated-disturbances"><span class="header-section-number">4</span> SUR motivation: contemporaneously correlated disturbances</h2>
<p>We may suspect that idiosyncratic macroeconomic shocks may have affected both firms. Consequently, there may be contemporaneous correlations in our disturbances that can be exploited to improve the efficiency of our OLS estimators.</p>
<p>Assuming the OLS estimation is unbiased, the residuals may be a good indicator of the economic disturbances so we may want to inspect visually if the two sets of residuals show similar patterns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> lm.US<span class="sc">$</span>res</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add local polinomial trend</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">predict</span>(<span class="fu">loess</span>(r<span class="sc">~</span>n)), <span class="at">col=</span><span class="st">'red'</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> lm.DM<span class="sc">$</span>res</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># add local polinomial trend</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">predict</span>(<span class="fu">loess</span>(r<span class="sc">~</span>n)), <span class="at">col=</span><span class="st">'red'</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="test_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The trend of the residuals appear correlated so we may consider using a panel model to improve the efficiency of our estimators.</p>
</section>
<section id="r-packages-for-panel-data-analysis-plm-and-systemfit" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="r-packages-for-panel-data-analysis-plm-and-systemfit"><span class="header-section-number">5</span> R packages for panel data analysis: PLM and SYSTEMFIT</h2>
<section id="configuring-data-as-a-panel" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="configuring-data-as-a-panel"><span class="header-section-number">5.1</span> Configuring data as a panel</h3>
<p>Two R packages frequently used for panel data analysis are PLM and SYSTEMFIT. To use the functions in these packages we must first configure our data as a panel object by specifying the columns containing the i and t indexing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>my.data <span class="ot">&lt;-</span> <span class="fu">pdata.frame</span>(my.raw.data, <span class="fu">c</span>(<span class="st">"firm"</span>, <span class="st">"year"</span>))  <span class="co">#configure the data as a panel</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        firm year  inv   val  cap
DM-1935   DM 1935 2.54 70.91 4.50
DM-1936   DM 1936 2.00 87.94 4.71
DM-1937   DM 1937 2.19 82.20 4.57
DM-1938   DM 1938 1.99 58.72 4.56
DM-1939   DM 1939 2.03 80.54 4.38
DM-1940   DM 1940 1.81 86.47 4.21</code></pre>
</div>
</div>
</section>
</section>
<section id="alternatives-to-lm-for-equation-by-equation-estimation" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="alternatives-to-lm-for-equation-by-equation-estimation"><span class="header-section-number">6</span> Alternatives to <em>lm()</em> for equation by equation estimation</h2>
<p>Functions in these packages allow us to do equation by equation OLS estimation directly without having to split our data. For example, the pvcm() function in the PLM package calculates the variable coefficients for each equation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>myOLS.pvcm <span class="ot">&lt;-</span> <span class="fu">pvcm</span>(inv <span class="sc">~</span> val <span class="sc">+</span> cap, <span class="at">data =</span> my.data, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>myOLS.pvcm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Formula: inv ~ val + cap
&lt;environment: 0x00000285cad0be00&gt;

Coefficients:
   (Intercept)       val     cap
DM     0.16152 0.0045734 0.43737
US   -49.19832 0.1748560 0.38964</code></pre>
</div>
</div>
<p>Or systemfit() in the SYSTEMFIT package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>myOLS.sysfit <span class="ot">&lt;-</span> <span class="fu">systemfit</span>(inv <span class="sc">~</span> val <span class="sc">+</span> cap, <span class="at">method =</span> <span class="st">"OLS"</span>, <span class="at">data =</span> my.data)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(myOLS.sysfit)$coeff</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_estimates</span>(myOLS.sysfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         term      estimate    std.error conf.level      conf.low    conf.high
1 (Intercept)   0.161518567   2.06556414       0.95   -4.19644084   4.51947797
2         val   0.004573432   0.02716079       0.95   -0.05273082   0.06187768
3         cap   0.437369190   0.07958891       0.95    0.26945128   0.60528710
4 (Intercept) -49.198321862 148.07536507       0.95 -361.61003378 263.21339006
5         val   0.174856015   0.07419805       0.95    0.01831182   0.33140021
6         cap   0.389641889   0.14236688       0.95    0.08927403   0.69000974
    statistic df.error      p.value component s.value group
1  0.07819586       17 9.385853e-01        DM     0.1      
2  0.16838365       17 8.682686e-01        DM     0.2      
3  5.49535372       17 3.940826e-05        DM    14.6      
4 -0.33225190       17 7.437606e-01        US     0.4      
5  2.35661209       17 3.069905e-02        US     5.0      
6  2.73688583       17 1.404874e-02        US     6.2      </code></pre>
</div>
</div>
<p>We could also compute the coefficients manually. This also highlights the data matrix arrangement in the SUR model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, US.data<span class="sc">$</span>val, US.data<span class="sc">$</span>cap,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)  <span class="co">#top half of the matrix</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>, DM.data<span class="sc">$</span>val, DM.data<span class="sc">$</span>cap)  <span class="co">#bottom half</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rbind</span>(X1,X2)                               <span class="co">#bind the two halfs</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> my.raw.data<span class="sc">$</span>inv                            <span class="co">#y vector</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>betas.ols <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> y</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>betas.ols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]
[1,] -49.198321862
[2,]   0.174856015
[3,]   0.389641889
[4,]   0.161518567
[5,]   0.004573432
[6,]   0.437369190</code></pre>
</div>
</div>
</section>
<section id="checking-residuals-covariance-matrix" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="checking-residuals-covariance-matrix"><span class="header-section-number">7</span> Checking residuals covariance matrix</h2>
<p>The systemfit() output object allows us to quickly look at the contemporaneous covariance and correlation matrices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(myOLS.sysfit)<span class="sc">$</span>residCov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          DM         US
DM  1.178043   73.45838
US 73.458384 9299.60405</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(myOLS.sysfit)<span class="sc">$</span>residCor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          DM        US
DM 1.0000000 0.7018245
US 0.7018245 1.0000000</code></pre>
</div>
</div>
<p>For some practice with Kronecker products in R, we may want to compute the estimated variance covariance matrix <span class="math inline">\(\hat{\Omega}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(DM.data<span class="sc">$</span>inv)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sigma_hat <span class="ot">&lt;-</span> <span class="fu">summary</span>(myOLS.sysfit)<span class="sc">$</span>residCov</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>omega_hat <span class="ot">&lt;-</span> sigma_hat <span class="sc">%x%</span> <span class="fu">diag</span>(N) <span class="co"># Kronecker product</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>omega_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
 [1,]  1.178043  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [2,]  0.000000  1.178043  0.000000  0.000000  0.000000  0.000000  0.000000
 [3,]  0.000000  0.000000  1.178043  0.000000  0.000000  0.000000  0.000000
 [4,]  0.000000  0.000000  0.000000  1.178043  0.000000  0.000000  0.000000
 [5,]  0.000000  0.000000  0.000000  0.000000  1.178043  0.000000  0.000000
 [6,]  0.000000  0.000000  0.000000  0.000000  0.000000  1.178043  0.000000
 [7,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  1.178043
 [8,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [9,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[10,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[11,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[12,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[13,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[14,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[15,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[16,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[17,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[18,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[19,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[20,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[21,] 73.458384  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[22,]  0.000000 73.458384  0.000000  0.000000  0.000000  0.000000  0.000000
[23,]  0.000000  0.000000 73.458384  0.000000  0.000000  0.000000  0.000000
[24,]  0.000000  0.000000  0.000000 73.458384  0.000000  0.000000  0.000000
[25,]  0.000000  0.000000  0.000000  0.000000 73.458384  0.000000  0.000000
[26,]  0.000000  0.000000  0.000000  0.000000  0.000000 73.458384  0.000000
[27,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000 73.458384
[28,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[29,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[30,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[31,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[32,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[33,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[34,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[35,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[36,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[37,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[38,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[39,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[40,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
           [,8]      [,9]     [,10]     [,11]     [,12]     [,13]     [,14]
 [1,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [2,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [3,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [4,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [5,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [6,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [7,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [8,]  1.178043  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
 [9,]  0.000000  1.178043  0.000000  0.000000  0.000000  0.000000  0.000000
[10,]  0.000000  0.000000  1.178043  0.000000  0.000000  0.000000  0.000000
[11,]  0.000000  0.000000  0.000000  1.178043  0.000000  0.000000  0.000000
[12,]  0.000000  0.000000  0.000000  0.000000  1.178043  0.000000  0.000000
[13,]  0.000000  0.000000  0.000000  0.000000  0.000000  1.178043  0.000000
[14,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  1.178043
[15,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[16,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[17,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[18,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[19,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[20,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[21,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[22,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[23,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[24,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[25,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[26,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[27,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[28,] 73.458384  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[29,]  0.000000 73.458384  0.000000  0.000000  0.000000  0.000000  0.000000
[30,]  0.000000  0.000000 73.458384  0.000000  0.000000  0.000000  0.000000
[31,]  0.000000  0.000000  0.000000 73.458384  0.000000  0.000000  0.000000
[32,]  0.000000  0.000000  0.000000  0.000000 73.458384  0.000000  0.000000
[33,]  0.000000  0.000000  0.000000  0.000000  0.000000 73.458384  0.000000
[34,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000 73.458384
[35,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[36,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[37,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[38,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[39,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
[40,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000
          [,15]     [,16]     [,17]     [,18]     [,19]     [,20]      [,21]
 [1,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000   73.45838
 [2,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
 [3,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
 [4,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
 [5,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
 [6,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
 [7,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
 [8,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
 [9,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[10,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[11,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[12,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[13,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[14,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[15,]  1.178043  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[16,]  0.000000  1.178043  0.000000  0.000000  0.000000  0.000000    0.00000
[17,]  0.000000  0.000000  1.178043  0.000000  0.000000  0.000000    0.00000
[18,]  0.000000  0.000000  0.000000  1.178043  0.000000  0.000000    0.00000
[19,]  0.000000  0.000000  0.000000  0.000000  1.178043  0.000000    0.00000
[20,]  0.000000  0.000000  0.000000  0.000000  0.000000  1.178043    0.00000
[21,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000 9299.60405
[22,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[23,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[24,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[25,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[26,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[27,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[28,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[29,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[30,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[31,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[32,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[33,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[34,]  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[35,] 73.458384  0.000000  0.000000  0.000000  0.000000  0.000000    0.00000
[36,]  0.000000 73.458384  0.000000  0.000000  0.000000  0.000000    0.00000
[37,]  0.000000  0.000000 73.458384  0.000000  0.000000  0.000000    0.00000
[38,]  0.000000  0.000000  0.000000 73.458384  0.000000  0.000000    0.00000
[39,]  0.000000  0.000000  0.000000  0.000000 73.458384  0.000000    0.00000
[40,]  0.000000  0.000000  0.000000  0.000000  0.000000 73.458384    0.00000
           [,22]      [,23]      [,24]      [,25]      [,26]      [,27]
 [1,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [2,]   73.45838    0.00000    0.00000    0.00000    0.00000    0.00000
 [3,]    0.00000   73.45838    0.00000    0.00000    0.00000    0.00000
 [4,]    0.00000    0.00000   73.45838    0.00000    0.00000    0.00000
 [5,]    0.00000    0.00000    0.00000   73.45838    0.00000    0.00000
 [6,]    0.00000    0.00000    0.00000    0.00000   73.45838    0.00000
 [7,]    0.00000    0.00000    0.00000    0.00000    0.00000   73.45838
 [8,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [9,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[10,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[11,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[12,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[13,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[14,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[15,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[16,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[17,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[18,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[19,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[20,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[21,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[22,] 9299.60405    0.00000    0.00000    0.00000    0.00000    0.00000
[23,]    0.00000 9299.60405    0.00000    0.00000    0.00000    0.00000
[24,]    0.00000    0.00000 9299.60405    0.00000    0.00000    0.00000
[25,]    0.00000    0.00000    0.00000 9299.60405    0.00000    0.00000
[26,]    0.00000    0.00000    0.00000    0.00000 9299.60405    0.00000
[27,]    0.00000    0.00000    0.00000    0.00000    0.00000 9299.60405
[28,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[29,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[30,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[31,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[32,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[33,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[34,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[35,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[36,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[37,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[38,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[39,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[40,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
           [,28]      [,29]      [,30]      [,31]      [,32]      [,33]
 [1,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [2,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [3,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [4,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [5,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [6,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [7,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [8,]   73.45838    0.00000    0.00000    0.00000    0.00000    0.00000
 [9,]    0.00000   73.45838    0.00000    0.00000    0.00000    0.00000
[10,]    0.00000    0.00000   73.45838    0.00000    0.00000    0.00000
[11,]    0.00000    0.00000    0.00000   73.45838    0.00000    0.00000
[12,]    0.00000    0.00000    0.00000    0.00000   73.45838    0.00000
[13,]    0.00000    0.00000    0.00000    0.00000    0.00000   73.45838
[14,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[15,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[16,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[17,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[18,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[19,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[20,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[21,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[22,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[23,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[24,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[25,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[26,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[27,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[28,] 9299.60405    0.00000    0.00000    0.00000    0.00000    0.00000
[29,]    0.00000 9299.60405    0.00000    0.00000    0.00000    0.00000
[30,]    0.00000    0.00000 9299.60405    0.00000    0.00000    0.00000
[31,]    0.00000    0.00000    0.00000 9299.60405    0.00000    0.00000
[32,]    0.00000    0.00000    0.00000    0.00000 9299.60405    0.00000
[33,]    0.00000    0.00000    0.00000    0.00000    0.00000 9299.60405
[34,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[35,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[36,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[37,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[38,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[39,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[40,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
           [,34]      [,35]      [,36]      [,37]      [,38]      [,39]
 [1,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [2,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [3,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [4,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [5,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [6,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [7,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [8,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
 [9,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[10,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[11,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[12,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[13,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[14,]   73.45838    0.00000    0.00000    0.00000    0.00000    0.00000
[15,]    0.00000   73.45838    0.00000    0.00000    0.00000    0.00000
[16,]    0.00000    0.00000   73.45838    0.00000    0.00000    0.00000
[17,]    0.00000    0.00000    0.00000   73.45838    0.00000    0.00000
[18,]    0.00000    0.00000    0.00000    0.00000   73.45838    0.00000
[19,]    0.00000    0.00000    0.00000    0.00000    0.00000   73.45838
[20,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[21,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[22,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[23,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[24,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[25,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[26,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[27,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[28,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[29,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[30,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[31,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[32,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[33,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
[34,] 9299.60405    0.00000    0.00000    0.00000    0.00000    0.00000
[35,]    0.00000 9299.60405    0.00000    0.00000    0.00000    0.00000
[36,]    0.00000    0.00000 9299.60405    0.00000    0.00000    0.00000
[37,]    0.00000    0.00000    0.00000 9299.60405    0.00000    0.00000
[38,]    0.00000    0.00000    0.00000    0.00000 9299.60405    0.00000
[39,]    0.00000    0.00000    0.00000    0.00000    0.00000 9299.60405
[40,]    0.00000    0.00000    0.00000    0.00000    0.00000    0.00000
           [,40]
 [1,]    0.00000
 [2,]    0.00000
 [3,]    0.00000
 [4,]    0.00000
 [5,]    0.00000
 [6,]    0.00000
 [7,]    0.00000
 [8,]    0.00000
 [9,]    0.00000
[10,]    0.00000
[11,]    0.00000
[12,]    0.00000
[13,]    0.00000
[14,]    0.00000
[15,]    0.00000
[16,]    0.00000
[17,]    0.00000
[18,]    0.00000
[19,]    0.00000
[20,]   73.45838
[21,]    0.00000
[22,]    0.00000
[23,]    0.00000
[24,]    0.00000
[25,]    0.00000
[26,]    0.00000
[27,]    0.00000
[28,]    0.00000
[29,]    0.00000
[30,]    0.00000
[31,]    0.00000
[32,]    0.00000
[33,]    0.00000
[34,]    0.00000
[35,]    0.00000
[36,]    0.00000
[37,]    0.00000
[38,]    0.00000
[39,]    0.00000
[40,] 9299.60405</code></pre>
</div>
</div>
</section>
<section id="tests-for-cross-sectional-dependence" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="tests-for-cross-sectional-dependence"><span class="header-section-number">8</span> Tests for cross-sectional dependence</h2>
<p>As suspected from the visual inspection, we note that there is indeed significant contemporaneous association for our residuals. We will confirm this using the standard tests for cross-sectional dependence:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pcdtest</span>(myOLS.pvcm, <span class="at">test =</span> <span class="fu">c</span>(<span class="st">"lm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Breusch-Pagan LM test for cross-sectional dependence in panels

data:  NULL
chisq = 9.8512, df = 1, p-value = 0.001697
alternative hypothesis: cross-sectional dependence</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pcdtest</span>(myOLS.pvcm, <span class="at">test =</span> <span class="fu">c</span>(<span class="st">"cd"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pesaran CD test for cross-sectional dependence in panels

data:  NULL
z = 3.1387, p-value = 0.001697
alternative hypothesis: cross-sectional dependence</code></pre>
</div>
</div>
<p>Both tests confirm that we can reject the null hypothesis of “no cross-sectional dependence” so we will go ahead and estimate the model using SUR:</p>
</section>
<section id="estimating-the-sur-model" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="estimating-the-sur-model"><span class="header-section-number">9</span> Estimating the SUR model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mySUR.sysfit <span class="ot">&lt;-</span> <span class="fu">systemfit</span>(inv <span class="sc">~</span> val <span class="sc">+</span> cap, <span class="at">method =</span> <span class="st">"SUR"</span>, <span class="at">data =</span> my.data)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mySUR.sysfit)$coeff</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_estimates</span>(mySUR.sysfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         term      estimate    std.error conf.level      conf.low    conf.high
1 (Intercept)   1.453986158   1.55155893       0.95   -1.81951703   4.72748935
2         val  -0.006542145   0.02103408       0.95   -0.05092018   0.03783589
3         cap   0.352518606   0.06886049       0.95    0.20723566   0.49780155
4 (Intercept) -97.359988436 110.40031946       0.95 -330.28430222 135.56432535
5         val   0.213114660   0.05541765       0.95    0.09619364   0.33003568
6         cap   0.297129690   0.13053611       0.95    0.02172256   0.57253682
   statistic df.error      p.value component s.value group
1  0.9371131       17 3.618238e-01        DM     1.5      
2 -0.3110259       17 7.595623e-01        DM     0.4      
3  5.1193157       17 8.543506e-05        DM    13.5      
4 -0.8818814       17 3.901401e-01        US     1.4      
5  3.8456098       17 1.295969e-03        US     9.6      
6  2.2762259       17 3.605550e-02        US     4.8      </code></pre>
</div>
</div>
<p>The SUR standard errors are slightly tighter indicating small efficiency gains.</p>
</section>
<section id="testing-the-homogeneous-coefficients-hypothesis" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="testing-the-homogeneous-coefficients-hypothesis"><span class="header-section-number">10</span> Testing the “homogeneous coefficients” hypothesis</h2>
<p>Finally, we may want to consider whether we can pool our data for the two firms and if parameters for the pooled dataset are significantly different from those estimated equation by equation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>my.Pooled.model <span class="ot">&lt;-</span> <span class="fu">plm</span>(inv <span class="sc">~</span> val <span class="sc">+</span> cap, <span class="at">data =</span> my.data, <span class="at">model =</span> <span class="st">"pooling"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_estimates</span>(my.Pooled.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         term    estimate   std.error conf.level    conf.low  conf.high
1 (Intercept) -11.1476225 15.01820589       0.95 -41.5773981 19.2821530
2         val   0.1567845  0.01773510       0.95   0.1208498  0.1927192
3         cap   0.3842592  0.09560581       0.95   0.1905434  0.5779750
   statistic df.error      p.value s.value group
1 -0.7422739       37 4.626078e-01     1.1      
2  8.8403488       37 1.180776e-10    33.0      
3  4.0192035       37 2.755406e-04    11.8      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pooltest</span>(my.Pooled.model, myOLS.pvcm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F statistic

data:  inv ~ val + cap
F = 0.047853, df1 = 3, df2 = 34, p-value = 0.9859
alternative hypothesis: unstability</code></pre>
</div>
</div>
<p>The Chow test for the poolability of the data cannot reject the null hypothesis that the coefficients are homogeneous across equations.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="test_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>