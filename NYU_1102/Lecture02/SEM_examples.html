<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dragos Ailoae">

<title>Estimating Simultaneous Equation Systems with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SEM_examples_files/libs/clipboard/clipboard.min.js"></script>
<script src="SEM_examples_files/libs/quarto-html/quarto.js"></script>
<script src="SEM_examples_files/libs/quarto-html/popper.min.js"></script>
<script src="SEM_examples_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SEM_examples_files/libs/quarto-html/anchor.min.js"></script>
<link href="SEM_examples_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SEM_examples_files/libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SEM_examples_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SEM_examples_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SEM_examples_files/libs/bootstrap/bootstrap-cf43a150f4ed865b4eb4d60b88c21c49.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="SEM_examples_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="SEM_examples_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro"><span class="header-section-number">1</span> Intro</a></li>
  <li><a href="#the-framework" id="toc-the-framework" class="nav-link" data-scroll-target="#the-framework"><span class="header-section-number">2</span> The framework</a>
  <ul class="collapse">
  <li><a href="#ols" id="toc-ols" class="nav-link" data-scroll-target="#ols"><span class="header-section-number">2.1</span> OLS</a></li>
  <li><a href="#sls" id="toc-sls" class="nav-link" data-scroll-target="#sls"><span class="header-section-number">2.2</span> 2SLS</a></li>
  <li><a href="#sur" id="toc-sur" class="nav-link" data-scroll-target="#sur"><span class="header-section-number">2.3</span> SUR</a></li>
  <li><a href="#sls-1" id="toc-sls-1" class="nav-link" data-scroll-target="#sls-1"><span class="header-section-number">2.4</span> 3SLS</a></li>
  </ul></li>
  <li><a href="#example-klein-1950-model-1" id="toc-example-klein-1950-model-1" class="nav-link" data-scroll-target="#example-klein-1950-model-1"><span class="header-section-number">3</span> Example: Klein (1950) Model 1</a>
  <ul class="collapse">
  <li><a href="#the-model" id="toc-the-model" class="nav-link" data-scroll-target="#the-model"><span class="header-section-number">3.1</span> The model</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">3.2</span> Load data</a></li>
  <li><a href="#set-up-equation-system" id="toc-set-up-equation-system" class="nav-link" data-scroll-target="#set-up-equation-system"><span class="header-section-number">3.3</span> Set up equation system</a></li>
  <li><a href="#ols-method" id="toc-ols-method" class="nav-link" data-scroll-target="#ols-method"><span class="header-section-number">3.4</span> OLS method</a></li>
  <li><a href="#sls-method" id="toc-sls-method" class="nav-link" data-scroll-target="#sls-method"><span class="header-section-number">3.5</span> 2SLS method</a></li>
  <li><a href="#sur-method" id="toc-sur-method" class="nav-link" data-scroll-target="#sur-method"><span class="header-section-number">3.6</span> SUR method</a></li>
  <li><a href="#sls-method-1" id="toc-sls-method-1" class="nav-link" data-scroll-target="#sls-method-1"><span class="header-section-number">3.7</span> 3SLS method</a></li>
  <li><a href="#overidentification-tests" id="toc-overidentification-tests" class="nav-link" data-scroll-target="#overidentification-tests"><span class="header-section-number">3.8</span> Overidentification tests</a></li>
  </ul></li>
  <li><a href="#greene-comparison" id="toc-greene-comparison" class="nav-link" data-scroll-target="#greene-comparison"><span class="header-section-number">4</span> Greene comparison</a></li>
  <li><a href="#takeaways" id="toc-takeaways" class="nav-link" data-scroll-target="#takeaways"><span class="header-section-number">5</span> Takeaways</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Estimating Simultaneous Equation Systems with R</h1>
<p class="subtitle lead">NYU - Applied Statistics and Econometrics 2</p>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dragos Ailoae </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="intro" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="intro"><span class="header-section-number">1</span> Intro</h2>
<p>Many theoretical models that are econometrically estimated consist of more than one equation. The disturbance terms of these equations are likely to be contemporaneously correlated, because unconsidered factors that influence the disturbance term in one equation probably influence the disturbance terms in other equations. Ignoring this contemporaneous correlation and estimating these equations separately leads to inefficient parameter estimates. However, estimating all equations simultaneously, taking the covariance structure of the residuals into account, leads to efficient estimates. This estimation procedure is generally called “Seemingly Unrelated Regression” (SUR) (Zellner, 1962). Another reason to estimate an equation system simultaneously are cross-equation parameter restrictions. These restrictions can be tested and/or imposed only in a simultaneous estimation approach.</p>
<p>Furthermore, these models can contain variables that appear on the left-hand side in one equation and on the right-hand side of another equation. Ignoring the endogeneity of these variables can lead to inconsistent parameter estimates. This simultaneity bias can be corrected for in each equation by applying a “Two-Stage Least Squares” (2SLS) method or for all equations simultaneously when combined with SUR resulting in a “Three-Stage Least Squares” (3SLS) estimation of the system of equations.</p>
<p>The systemfit package provides the capability to estimate linear equation systems in R. For more information read <a href="https://cran.r-project.org/web/packages/systemfit/systemfit.pdf">here</a> and <a href="https://mpra.ub.uni-muenchen.de/1421/1/MPRA_paper_1421.pdf">here</a>.</p>
</section>
<section id="the-framework" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="the-framework"><span class="header-section-number">2</span> The framework</h2>
<p>Consider a system of <span class="math inline">\(M\)</span> equations</p>
<p><span class="math display">\[
\left[\begin{array}{c}
y_1 \\
y_2 \\
\vdots \\
y_M
\end{array}\right]=\left[\begin{array}{cccc}
x_1 &amp; 0 &amp; \ldots &amp; 0 \\
0 &amp; x_2 &amp; \ldots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \ldots &amp; x_M
\end{array}\right]\left[\begin{array}{c}
\beta_1 \\
\beta_2 \\
\vdots \\
\beta_M
\end{array}\right]+\left[\begin{array}{c}
u_1 \\
u_2 \\
\vdots \\
u_M
\end{array}\right]
\]</span></p>
<p>or more simply <span class="math inline">\(\mathbf{y}=\mathbf{X} \beta+\mathbf{u}\)</span></p>
<p><strong>Assumption about disturbance terms:</strong></p>
<ul>
<li>No correlation across observations: <span class="math inline">\(E\left(u_{i t} u_{j t^*}\right) = 0 \quad \forall t \neq t^*\)</span></li>
<li>But allow for contemporaneous correlation: <span class="math inline">\(E\left(u_{i t} u_{j t}\right)=\sigma_{i j}\)</span></li>
</ul>
<p>So the covariance matrix of the total system is</p>
<p><span class="math display">\[
E\left(\mathbf{u u}^{\prime}\right)=\Omega=\Sigma \otimes I
\]</span></p>
<p>where <span class="math inline">\(\Sigma=\left[\sigma_{i j}\right]\)</span> is the covariance matrix of the residuals</p>
<section id="ols" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="ols"><span class="header-section-number">2.1</span> OLS</h3>
<p><strong>Ordinary Least Squares (OLS) estimator</strong> <span class="math inline">\(\hat{\beta}_{\text{OLS}}\)</span> is</p>
<p><span class="math display">\[
\hat{\beta}_{\text{OLS}}=\left(\mathbf{X}^{\prime} \mathbf{X}\right)^{-1} \mathbf{X}^{\prime} \mathbf{y}
\]</span></p>
<p><strong>Unbiased</strong> if regressors are not correlated with disturbances:</p>
<p><span class="math display">\[
E\left(u_i \mid X_i\right)=0 \quad \forall i=1, \ldots, G
\]</span></p>
<p><strong>Efficient</strong> only if disturbance terms are not correlated across equations:</p>
<p><span class="math display">\[
\sigma_{i j}=0 \quad \forall i \neq j
\]</span></p>
</section>
<section id="sls" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="sls"><span class="header-section-number">2.2</span> 2SLS</h3>
<p>Come up with instruments <span class="math inline">\(H_i\)</span> to address endogeneity problem:</p>
<p><span class="math display">\[
E\left(u_i \mid H_i\right)=0 \quad \forall i=1, \ldots, G
\]</span></p>
<p><strong>First stage:</strong> Get fitted values <span class="math inline">\(\hat{X}_i\)</span> from regressing <span class="math inline">\(X_i\)</span> on <span class="math inline">\(H_i\)</span></p>
<p><span class="math display">\[
\hat{X}_i=H_i\left(H_i^{\prime} H_i\right)^{-1} H_i^{\prime} X_i
\]</span></p>
<p><strong>Second stage:</strong> Unbiased 2 Stage Least Squares (2SLS) estimator <span class="math inline">\(\hat{\beta}_{2\text{SLS}}\)</span></p>
<p><span class="math display">\[
\hat{\beta}_{2\text{SLS}}=\left(\widehat{\mathbf{X}}^{\prime} \widehat{\mathbf{X}}\right)^{-1} \widehat{\mathbf{X}}^{\prime} \mathbf{y}
\]</span></p>
<p><strong>NOTE:</strong> Efficient only if disturbance terms are not correlated across equations</p>
<p><span class="math display">\[
\sigma_{i j}=0 \quad \forall i \neq j
\]</span></p>
</section>
<section id="sur" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="sur"><span class="header-section-number">2.3</span> SUR</h3>
<p><strong>Seemingly Unrelated Regression (SUR)</strong> estimator <span class="math inline">\(\hat{\beta}_{\text{SUR}}\)</span></p>
<p><span class="math display">\[
\hat{\beta}_{\text{SUR}}=\left(\mathbf{X}^{\prime} \Omega^{-1} \mathbf{X}\right)^{-1} \mathbf{X}^{\prime} \Omega^{-1} \mathbf{y}
\]</span></p>
<ul>
<li>Estimates the system using Generalized Least Squares (GLS)</li>
<li>Leads to efficient estimates</li>
<li>But biased if all regressors are correlated with all disturbances</li>
</ul>
<p><strong>NOTE:</strong></p>
<ul>
<li>Unbiased OLS requires <span class="math inline">\(E\left(u_i \mid X_i\right)=0\)</span> for each single equation <span class="math inline">\(i\)</span></li>
<li>But unbiased SUR requires <span class="math inline">\(E\left(u_i \mid X_j\right)=0\)</span> across all equations <span class="math inline">\((i, j)\)</span></li>
</ul>
</section>
<section id="sls-1" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="sls-1"><span class="header-section-number">2.4</span> 3SLS</h3>
<p>Basically a GLS version of the 2SLS estimator</p>
<p><strong>3 Stage Least Squares (3SLS) estimator</strong> <span class="math inline">\(\hat{\beta}_{3\text{SLS}}\)</span></p>
<p><span class="math display">\[
\hat{\beta}_{3\text{SLS}}=\left(\widehat{\mathbf{X}}^{\prime} \Omega^{-1} \widehat{\mathbf{X}}\right)^{-1} \widehat{\mathbf{X}}^{\prime} \Omega^{-1} \mathbf{y}
\]</span></p>
<p>Leads to efficient estimates</p>
<p><strong>NOTE:</strong></p>
<ul>
<li>Unbiased 2SLS requires <span class="math inline">\(E\left(u_i \mid H_i\right)=0\)</span> for each single equation</li>
<li>But unbiased 3SLS requires <span class="math inline">\(E\left(u_i \mid H_j\right)=0\)</span> across all equations <span class="math inline">\((i, j)\)</span></li>
</ul>
</section>
</section>
<section id="example-klein-1950-model-1" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="example-klein-1950-model-1"><span class="header-section-number">3</span> Example: Klein (1950) Model 1</h2>
<p>As described in Greene textbook and following the implementation in Henningsen and Hamann (2006).</p>
<section id="the-model" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="the-model"><span class="header-section-number">3.1</span> The model</h3>
<p>Macroeconomic model with 6 equations to study 6 endogenous variables:</p>
<span class="math display">\[\begin{array}{rlrl}
C_t &amp; =\alpha_0+\alpha_1 \Pi_t+\alpha_2 \Pi_{t-1}+\alpha_3\left(W_t+W_t^g\right)+u_{1 t} &amp; \text { (consumption), } \\
I_t &amp; =\beta_0+\beta_1 \Pi_t+\beta_2 \Pi_{t-1}+\beta_3 K_{t-1} +u_{2 t} &amp; \text { (investment), } \\
W_t &amp; =\gamma_0+\gamma_1 Y_t+\gamma_2 Y_{t-1}+\gamma_3 t +u_{3 t} &amp; \text { (private wages), } \\
Y_t &amp; =C_t+I_t+G_t &amp;  \text { (equilibrium demand), } \\
\Pi_t &amp; =Y_t-T_t-W_t  &amp; \text { (private profits), } \\
K_t &amp; =K_{t-1}+I_t &amp;  \text { (capital stock). }
\end{array}\]</span>
<p><strong>Where:</strong></p>
<ul>
<li><span class="math inline">\(C\)</span> = consumption expenditure</li>
<li><span class="math inline">\(I\)</span> = investment expenditure</li>
<li><span class="math inline">\(G\)</span> = government expenditure</li>
<li><span class="math inline">\(\Pi\)</span> = profits</li>
<li><span class="math inline">\(W\)</span> = private wage bill</li>
<li><span class="math inline">\(W^g\)</span> = government wage bill</li>
<li><span class="math inline">\(T\)</span> = taxes</li>
<li><span class="math inline">\(Y\)</span> = income after tax</li>
<li><span class="math inline">\(t\)</span> = time trend</li>
</ul>
<p><strong>Endogenous</strong> (jointly dependent) variables: <span class="math inline">\(C_t, I_t, W_t, Y_t, \Pi_t, K_t\)</span></p>
<p><strong>Exogenous</strong> variables: <span class="math inline">\(G_t, T_t, W_t^g\)</span>, and <span class="math inline">\(t\)</span></p>
<p><strong>Predetermined</strong> variables: <span class="math inline">\(\Pi_{t-1}, K_{t-1}\)</span>, and <span class="math inline">\(Y_{t-1}\)</span></p>
<p>The problem is that the endogenous variables depend on each other therefore disturbances are correlated across equations. This means that estimating the system using OLS might not be appropriate since <span class="math inline">\(E\left(u_i \mid X_i\right)\neq 0\)</span></p>
</section>
<section id="load-data" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="load-data"><span class="header-section-number">3.2</span> Load data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())    <span class="co"># Removes all items in Environment!</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LOAD PACKAGES:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(systemfit)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Klein I data              </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"KleinI"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>my.data <span class="ot">&lt;-</span> KleinI</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(my.data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: right;">consump</th>
<th style="text-align: right;">corpProf</th>
<th style="text-align: right;">corpProfLag</th>
<th style="text-align: right;">privWage</th>
<th style="text-align: right;">invest</th>
<th style="text-align: right;">capitalLag</th>
<th style="text-align: right;">gnp</th>
<th style="text-align: right;">gnpLag</th>
<th style="text-align: right;">govWage</th>
<th style="text-align: right;">govExp</th>
<th style="text-align: right;">taxes</th>
<th style="text-align: right;">wages</th>
<th style="text-align: right;">trend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1920</td>
<td style="text-align: right;">39.8</td>
<td style="text-align: right;">12.7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">28.8</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">180.1</td>
<td style="text-align: right;">44.9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">3.4</td>
<td style="text-align: right;">31.0</td>
<td style="text-align: right;">-11</td>
</tr>
<tr class="even">
<td style="text-align: right;">1921</td>
<td style="text-align: right;">41.9</td>
<td style="text-align: right;">12.4</td>
<td style="text-align: right;">12.7</td>
<td style="text-align: right;">25.5</td>
<td style="text-align: right;">-0.2</td>
<td style="text-align: right;">182.8</td>
<td style="text-align: right;">45.6</td>
<td style="text-align: right;">44.9</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">28.2</td>
<td style="text-align: right;">-10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1922</td>
<td style="text-align: right;">45.0</td>
<td style="text-align: right;">16.9</td>
<td style="text-align: right;">12.4</td>
<td style="text-align: right;">29.3</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">182.6</td>
<td style="text-align: right;">50.1</td>
<td style="text-align: right;">45.6</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">32.2</td>
<td style="text-align: right;">-9</td>
</tr>
<tr class="even">
<td style="text-align: right;">1923</td>
<td style="text-align: right;">49.2</td>
<td style="text-align: right;">18.4</td>
<td style="text-align: right;">16.9</td>
<td style="text-align: right;">34.1</td>
<td style="text-align: right;">5.2</td>
<td style="text-align: right;">184.5</td>
<td style="text-align: right;">57.2</td>
<td style="text-align: right;">50.1</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">37.0</td>
<td style="text-align: right;">-8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1924</td>
<td style="text-align: right;">50.6</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: right;">18.4</td>
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">189.7</td>
<td style="text-align: right;">57.1</td>
<td style="text-align: right;">57.2</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: right;">37.0</td>
<td style="text-align: right;">-7</td>
</tr>
<tr class="even">
<td style="text-align: right;">1925</td>
<td style="text-align: right;">52.6</td>
<td style="text-align: right;">20.1</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: right;">35.4</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">192.7</td>
<td style="text-align: right;">61.0</td>
<td style="text-align: right;">57.1</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">3.3</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">38.6</td>
<td style="text-align: right;">-6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="set-up-equation-system" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="set-up-equation-system"><span class="header-section-number">3.3</span> Set up equation system</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consumption equation</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>eq.Consump <span class="ot">&lt;-</span> consump <span class="sc">~</span> corpProf <span class="sc">+</span> corpProfLag <span class="sc">+</span> wages</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Investment equation</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>eq.Invest <span class="ot">&lt;-</span> invest <span class="sc">~</span> corpProf <span class="sc">+</span> corpProfLag <span class="sc">+</span> capitalLag</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Private Wage equation</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>eq.PrivWage <span class="ot">&lt;-</span> privWage <span class="sc">~</span> gnp <span class="sc">+</span> gnpLag <span class="sc">+</span> trend</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the system of equations</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>eq.System <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">C =</span> eq.Consump,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">I =</span> eq.Invest,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">W =</span> eq.PrivWage)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># List of all the instruments</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>inst <span class="ot">&lt;-</span> <span class="er">~</span> govExp <span class="sc">+</span> taxes <span class="sc">+</span> govWage <span class="sc">+</span> trend <span class="sc">+</span>      <span class="co"># exogenous variables</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>          capitalLag <span class="sc">+</span> corpProfLag <span class="sc">+</span> gnpLag       <span class="co"># predetermined variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ols-method" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="ols-method"><span class="header-section-number">3.4</span> OLS method</h3>
<p>This method ignores the equation system structure and estimates the system equation by equation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mdl.sysfit.ols <span class="ot">&lt;-</span> <span class="fu">systemfit</span>(<span class="at">formula =</span> eq.System, <span class="at">method =</span> <span class="st">"OLS"</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> my.data, <span class="at">methodResidCov =</span> <span class="st">"noDfCor"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">get_estimates</span>(mdl.sysfit.ols)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>tbl.ols <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Equation"</span> <span class="ot">=</span> tmp<span class="sc">$</span>component, <span class="st">"Term"</span> <span class="ot">=</span> tmp<span class="sc">$</span>term, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Estimate"</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>estimate, <span class="dv">3</span>), </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"S.E."</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>std.error, <span class="dv">3</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tbl.ols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Equation</th>
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">S.E.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">16.237</td>
<td style="text-align: right;">1.172</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">0.193</td>
<td style="text-align: right;">0.082</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.090</td>
<td style="text-align: right;">0.082</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">wages</td>
<td style="text-align: right;">0.796</td>
<td style="text-align: right;">0.036</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">10.126</td>
<td style="text-align: right;">4.918</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">0.480</td>
<td style="text-align: right;">0.087</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.333</td>
<td style="text-align: right;">0.091</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">capitalLag</td>
<td style="text-align: right;">-0.112</td>
<td style="text-align: right;">0.024</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.497</td>
<td style="text-align: right;">1.143</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnp</td>
<td style="text-align: right;">0.439</td>
<td style="text-align: right;">0.029</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnpLag</td>
<td style="text-align: right;">0.146</td>
<td style="text-align: right;">0.034</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">trend</td>
<td style="text-align: right;">0.130</td>
<td style="text-align: right;">0.029</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="sls-method" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="sls-method"><span class="header-section-number">3.5</span> 2SLS method</h3>
<p>This method does equation by equation estimation but uses IV to correct for endogeneity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mdl.sysfit<span class="fl">.2</span>sls <span class="ot">&lt;-</span> <span class="fu">systemfit</span>(<span class="at">formula =</span> eq.System, <span class="at">method =</span> <span class="st">"2SLS"</span>, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">inst =</span> inst, <span class="at">data =</span> my.data, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">methodResidCov =</span> <span class="st">"noDfCor"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">get_estimates</span>(mdl.sysfit<span class="fl">.2</span>sls)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>tbl<span class="fl">.2</span>SLS <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Equation"</span> <span class="ot">=</span> tmp<span class="sc">$</span>component, <span class="st">"Term"</span> <span class="ot">=</span> tmp<span class="sc">$</span>term, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Estimate"</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>estimate, <span class="dv">3</span>), </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"S.E."</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>std.error, <span class="dv">3</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tbl<span class="fl">.2</span>SLS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Equation</th>
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">S.E.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">16.555</td>
<td style="text-align: right;">1.321</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">0.017</td>
<td style="text-align: right;">0.118</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.216</td>
<td style="text-align: right;">0.107</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">wages</td>
<td style="text-align: right;">0.810</td>
<td style="text-align: right;">0.040</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">20.278</td>
<td style="text-align: right;">7.543</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">0.150</td>
<td style="text-align: right;">0.173</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.616</td>
<td style="text-align: right;">0.163</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">capitalLag</td>
<td style="text-align: right;">-0.158</td>
<td style="text-align: right;">0.036</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.500</td>
<td style="text-align: right;">1.148</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnp</td>
<td style="text-align: right;">0.439</td>
<td style="text-align: right;">0.036</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnpLag</td>
<td style="text-align: right;">0.147</td>
<td style="text-align: right;">0.039</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">trend</td>
<td style="text-align: right;">0.130</td>
<td style="text-align: right;">0.029</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="sur-method" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="sur-method"><span class="header-section-number">3.6</span> SUR method</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mdl.sysfit.sur <span class="ot">&lt;-</span> <span class="fu">systemfit</span>(<span class="at">formula =</span> eq.System, <span class="at">method =</span> <span class="st">"SUR"</span>, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> my.data, <span class="at">methodResidCov =</span> <span class="st">"noDfCor"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">get_estimates</span>(mdl.sysfit.sur)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>tbl.SUR <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Equation"</span> <span class="ot">=</span> tmp<span class="sc">$</span>component, <span class="st">"Term"</span> <span class="ot">=</span> tmp<span class="sc">$</span>term, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Estimate"</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>estimate, <span class="dv">3</span>), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"S.E."</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>std.error, <span class="dv">3</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tbl.SUR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Equation</th>
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">S.E.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">15.981</td>
<td style="text-align: right;">1.169</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">0.230</td>
<td style="text-align: right;">0.077</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.067</td>
<td style="text-align: right;">0.077</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">wages</td>
<td style="text-align: right;">0.796</td>
<td style="text-align: right;">0.035</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">12.929</td>
<td style="text-align: right;">4.801</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">0.443</td>
<td style="text-align: right;">0.086</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.365</td>
<td style="text-align: right;">0.089</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">capitalLag</td>
<td style="text-align: right;">-0.125</td>
<td style="text-align: right;">0.023</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.635</td>
<td style="text-align: right;">1.117</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnp</td>
<td style="text-align: right;">0.410</td>
<td style="text-align: right;">0.027</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnpLag</td>
<td style="text-align: right;">0.174</td>
<td style="text-align: right;">0.031</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">trend</td>
<td style="text-align: right;">0.156</td>
<td style="text-align: right;">0.028</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="sls-method-1" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="sls-method-1"><span class="header-section-number">3.7</span> 3SLS method</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mdl.sysfit<span class="fl">.3</span>sls <span class="ot">&lt;-</span> <span class="fu">systemfit</span>(<span class="at">formula =</span> eq.System, <span class="at">method =</span> <span class="st">"3SLS"</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">inst =</span> inst, <span class="at">data =</span> my.data, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">methodResidCov =</span> <span class="st">"noDfCor"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">get_estimates</span>(mdl.sysfit<span class="fl">.3</span>sls)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>tbl<span class="fl">.3</span>SLS <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Equation"</span> <span class="ot">=</span> tmp<span class="sc">$</span>component, <span class="st">"Term"</span> <span class="ot">=</span> tmp<span class="sc">$</span>term, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Estimate"</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>estimate, <span class="dv">3</span>), </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"S.E."</span> <span class="ot">=</span> <span class="fu">round</span>(tmp<span class="sc">$</span>std.error, <span class="dv">3</span>))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tbl<span class="fl">.3</span>SLS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Equation</th>
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">S.E.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">16.441</td>
<td style="text-align: right;">1.305</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.108</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.163</td>
<td style="text-align: right;">0.100</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">wages</td>
<td style="text-align: right;">0.790</td>
<td style="text-align: right;">0.038</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">28.178</td>
<td style="text-align: right;">6.794</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: right;">-0.013</td>
<td style="text-align: right;">0.162</td>
</tr>
<tr class="odd">
<td style="text-align: left;">I</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: right;">0.756</td>
<td style="text-align: right;">0.153</td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;">capitalLag</td>
<td style="text-align: right;">-0.195</td>
<td style="text-align: right;">0.033</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.797</td>
<td style="text-align: right;">1.116</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnp</td>
<td style="text-align: right;">0.400</td>
<td style="text-align: right;">0.032</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W</td>
<td style="text-align: left;">gnpLag</td>
<td style="text-align: right;">0.181</td>
<td style="text-align: right;">0.034</td>
</tr>
<tr class="even">
<td style="text-align: left;">W</td>
<td style="text-align: left;">trend</td>
<td style="text-align: right;">0.150</td>
<td style="text-align: right;">0.028</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="overidentification-tests" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="overidentification-tests"><span class="header-section-number">3.8</span> Overidentification tests</h3>
<p>When an equation is over-identified (more instruments than endogenous regressors), we can test whether the overidentifying restrictions are valid. This tests whether the excluded instruments are truly exogenous (uncorrelated with the error term).</p>
<p><strong>Sargan test for 2SLS:</strong></p>
<p>The null hypothesis is that the instruments are valid (uncorrelated with the error term). A significant p-value suggests the instruments may be invalid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sargan test for 2SLS</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sargan Test for 2SLS:</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sargan Test for 2SLS:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consumption equation</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Consumption equation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Consumption equation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Endogenous variables: C, W, Π (M₁ = 3)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Endogenous variables: C, W, Π (M₁ = 3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Excluded instruments: G, t (K₁* = 2)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Excluded instruments: G, t (K₁* = 2)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - K₁* = 2 ≥ M₁ - 1 = 2 → Exactly identified</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - K₁* = 2 ≥ M₁ - 1 = 2 → Exactly identified</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - No overidentification test possible (df = 0)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - No overidentification test possible (df = 0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Investment equation  </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Investment equation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Investment equation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Endogenous variables: I, Π (M₂ = 2)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Endogenous variables: I, Π (M₂ = 2)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Excluded instruments: W^g, G, t (K₂* = 3)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Excluded instruments: W^g, G, t (K₂* = 3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - K₂* = 3 &gt; M₂ - 1 = 1 → Over-identified (1 overidentifying restriction)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - K₂* = 3 &gt; M₂ - 1 = 1 → Over-identified (1 overidentifying restriction)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For investment equation, compute Sargan test</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get residuals from 2SLS estimation</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>invest_resid <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mdl.sysfit<span class="fl">.2</span>sls)<span class="sc">$</span>I</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create instrument matrix (all instruments)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Instruments: govExp, taxes, govWage, trend, capitalLag, corpProfLag, gnpLag</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, my.data<span class="sc">$</span>govExp, my.data<span class="sc">$</span>taxes, my.data<span class="sc">$</span>govWage, my.data<span class="sc">$</span>trend,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>           my.data<span class="sc">$</span>capitalLag, my.data<span class="sc">$</span>corpProfLag, my.data<span class="sc">$</span>gnpLag)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Regress 2SLS residuals on all instruments</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>sargan_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(invest_resid <span class="sc">~</span> Z <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(invest_resid)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(sargan_reg)<span class="sc">$</span>r.squared</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Sargan test statistic = n * R²</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Under H₀, this follows χ² </span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># df = total instruments - total regressors (including endogenous)</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Total instruments: 7 (govExp, taxes, govWage, trend, capitalLag, corpProfLag, gnpLag)</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Total regressors: 3 (corpProf, corpProfLag, capitalLag) </span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># df = 7 - 3 = 4</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: This differs from the order condition calculation which focused on</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co"># "excluded" instruments. Here we count ALL instruments vs ALL regressors.</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>sargan_stat <span class="ot">&lt;-</span> n <span class="sc">*</span> r2</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>df_sargan <span class="ot">&lt;-</span> <span class="dv">4</span>  <span class="co"># Total instruments - total regressors</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>p_val_sargan <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(sargan_stat, df_sargan)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  Sargan statistic = %.3f</span><span class="sc">\n</span><span class="st">"</span>, sargan_stat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sargan statistic = 1.901</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  Degrees of freedom = %d</span><span class="sc">\n</span><span class="st">"</span>, df_sargan))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Degrees of freedom = 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  P-value = %.3f</span><span class="sc">\n\n</span><span class="st">"</span>, p_val_sargan))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  P-value = 0.754</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (p_val_sargan <span class="sc">&gt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  → Cannot reject H₀: instruments are valid (p &gt; 0.05)</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  → Reject H₀: instruments may be invalid (p &lt; 0.05)</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Cannot reject H₀: instruments are valid (p &gt; 0.05)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage equation</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Private wage equation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Private wage equation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Endogenous variables: W, C, I (M₃ = 3)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Endogenous variables: W, C, I (M₃ = 3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Excluded instruments: W^g (K₃* = 1)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Excluded instruments: W^g (K₃* = 1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - K₃* = 1 &lt; M₃ - 1 = 2 → Under-identified</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - K₃* = 1 &lt; M₃ - 1 = 2 → Under-identified</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Cannot be estimated consistently</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Cannot be estimated consistently</code></pre>
</div>
</div>
<section id="comparison-with-packaged-test-routines" class="level4" data-number="3.8.1">
<h4 data-number="3.8.1" class="anchored" data-anchor-id="comparison-with-packaged-test-routines"><span class="header-section-number">3.8.1</span> Comparison with packaged test routines</h4>
<p>We can verify our manual Sargan test calculation using the <code>AER</code> package, which provides built-in diagnostics for IV regression including overidentification tests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate investment equation using ivreg</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Investment equation: invest ~ corpProf + corpProfLag + capitalLag</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># corpProf is endogenous, need to instrument it</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Instruments: all exogenous and predetermined variables</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>invest.iv <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(invest <span class="sc">~</span> corpProf <span class="sc">+</span> corpProfLag <span class="sc">+</span> capitalLag <span class="sc">|</span> </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                     govExp <span class="sc">+</span> taxes <span class="sc">+</span> govWage <span class="sc">+</span> trend <span class="sc">+</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                     capitalLag <span class="sc">+</span> corpProfLag <span class="sc">+</span> gnpLag,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> my.data)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary with diagnostics</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AER package diagnostics for Investment equation:</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AER package diagnostics for Investment equation:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(invest.iv, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = invest ~ corpProf + corpProfLag + capitalLag | 
    govExp + taxes + govWage + trend + capitalLag + corpProfLag + 
        gnpLag, data = my.data)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.2909 -0.8069  0.1423  0.8601  1.7956 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 20.27821    8.38325   2.419  0.02707 * 
corpProf     0.15022    0.19253   0.780  0.44598   
corpProfLag  0.61594    0.18093   3.404  0.00338 **
capitalLag  -0.15779    0.04015  -3.930  0.00108 **

Diagnostic tests:
                 df1 df2 statistic  p-value    
Weak instruments   5  13     1.934 0.156630    
Wu-Hausman         1  16    16.230 0.000972 ***
Sargan             4  NA     1.815 0.769743    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.307 on 17 degrees of freedom
Multiple R-Squared: 0.8849, Adjusted R-squared: 0.8646 
Wald test:  41.2 on 3 and 17 DF,  p-value: 5.148e-08 </code></pre>
</div>
</div>
<p><strong>Comparison of results:</strong></p>
<p>The <code>summary()</code> output with <code>diagnostics = TRUE</code> provides several tests:</p>
<ol type="1">
<li><strong>Weak instruments test</strong>: Tests whether instruments are relevant (strong first stage)
<ul>
<li>F-statistic = 1.934, p-value = 0.157</li>
<li>Rule of thumb: F &gt; 10 is considered strong</li>
<li>Result: Instruments may be weak (F &lt; 10)</li>
</ul></li>
<li><strong>Wu-Hausman test</strong>: Tests for endogeneity (whether OLS vs IV makes a difference)
<ul>
<li>Statistic = 16.230, p-value = 0.001</li>
<li>Result: Strong evidence of endogeneity, IV estimation is needed</li>
</ul></li>
<li><strong>Sargan test</strong>: Tests overidentifying restrictions (what we computed manually)
<ul>
<li>AER: Statistic = 1.815, df = 4, p-value = 0.770</li>
<li>Manual: Statistic ≈ 1.901, df = 4, p-value ≈ 0.386</li>
<li>Result: Cannot reject validity of instruments</li>
</ul></li>
</ol>
<p><strong>Why do the test statistics differ slightly?</strong></p>
<p>The small difference between manual (1.901) and AER (1.815) calculations can arise from:</p>
<ol type="1">
<li><p><strong>Residual calculation</strong>:</p>
<ul>
<li>Manual: Uses 2SLS residuals from <code>systemfit</code> (fitted system estimation)</li>
<li>AER: Uses residuals from single-equation <code>ivreg</code> estimation</li>
<li>System estimation may produce slightly different residuals</li>
</ul></li>
<li><p><strong>Degrees of freedom corrections</strong>: Different implementations may use different small-sample adjustments</p></li>
<li><p><strong>Numerical precision</strong>: Matrix operations can accumulate small rounding differences</p></li>
</ol>
<p>Despite these small differences, both tests lead to the same conclusion: we cannot reject the validity of the instruments (high p-values in both cases).</p>
<p><strong>Interpretation:</strong></p>
<ul>
<li>The <strong>consumption equation</strong> is exactly identified, so there are no overidentifying restrictions to test</li>
<li>The <strong>investment equation</strong> is over-identified:
<ul>
<li>Order condition: K₂* = 3 &gt; M₂ - 1 = 1 (1 overidentifying restriction from this perspective)</li>
</ul></li>
<li>The <strong>wage equation</strong> is under-identified and cannot be consistently estimated with 2SLS</li>
</ul>
<p><strong>Key findings from investment equation diagnostics:</strong></p>
<ol type="1">
<li><strong>Weak instruments (F = 1.934)</strong>: The instruments may be weak (F &lt; 10). This is concerning and suggests:
<ul>
<li>First-stage explanatory power is low</li>
<li>2SLS estimates may be imprecise or biased in small samples</li>
<li>Consider finding stronger instruments if possible</li>
</ul></li>
<li><strong>Wu-Hausman (p &lt; 0.001)</strong>: Strong evidence that corpProf is endogenous
<ul>
<li>OLS would produce biased estimates</li>
<li>IV estimation is necessary</li>
</ul></li>
<li><strong>Sargan (p = 0.770)</strong>: Cannot reject instrument validity
<ul>
<li>The overidentifying restrictions are satisfied</li>
<li>Instruments appear to be exogenous</li>
<li>However, this test has low power with weak instruments</li>
</ul></li>
</ol>
<p><strong>Overall assessment:</strong></p>
<p>While the Sargan test suggests instruments are valid, the weak instruments problem is a concern. In practice, you might want to: - Seek stronger instruments - Use weak-instrument-robust inference methods - Be cautious about the precision of estimates</p>
<p>If the Sargan test p-value is &gt; 0.05, we fail to reject the null hypothesis that the instruments are valid. Combined with a significant Wu-Hausman test, this supports using 2SLS/3SLS estimation, though the weak instruments issue warrants attention.</p>
<p><strong>Note on 3SLS:</strong> The 3SLS estimator uses the same instruments, so the validity concerns are the same. The system-wide Hansen J test would provide similar conclusions but accounts for cross-equation correlation.</p>
</section>
</section>
</section>
<section id="greene-comparison" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="greene-comparison"><span class="header-section-number">4</span> Greene comparison</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>tbl.Compare <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Equation"</span> <span class="ot">=</span> tmp<span class="sc">$</span>component, <span class="st">"Term"</span> <span class="ot">=</span> tmp<span class="sc">$</span>term, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Est.2SLS"</span> <span class="ot">=</span> tbl<span class="fl">.2</span>SLS<span class="sc">$</span>Estimate, <span class="st">"SE.2SLS"</span> <span class="ot">=</span> tbl<span class="fl">.2</span>SLS<span class="sc">$</span>S.E.,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Est.3SLS"</span> <span class="ot">=</span> tbl<span class="fl">.3</span>SLS<span class="sc">$</span>Estimate, <span class="st">"SE.3SLS"</span> <span class="ot">=</span> tbl<span class="fl">.3</span>SLS<span class="sc">$</span>S.E.,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Est.SUR"</span> <span class="ot">=</span> tbl.SUR<span class="sc">$</span>Estimate, <span class="st">"SE.SUR"</span> <span class="ot">=</span> tbl.SUR<span class="sc">$</span>S.E.,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Est.OLS"</span> <span class="ot">=</span> tbl.ols<span class="sc">$</span>Estimate, <span class="st">"SE.OLS"</span> <span class="ot">=</span> tbl.ols<span class="sc">$</span>S.E.)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">t</span>(tbl.Compare), <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Equation</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">I</td>
<td style="text-align: left;">I</td>
<td style="text-align: left;">I</td>
<td style="text-align: left;">I</td>
<td style="text-align: left;">W</td>
<td style="text-align: left;">W</td>
<td style="text-align: left;">W</td>
<td style="text-align: left;">W</td>
</tr>
<tr class="even">
<td style="text-align: left;">Term</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: left;">wages</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: left;">corpProf</td>
<td style="text-align: left;">corpProfLag</td>
<td style="text-align: left;">capitalLag</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: left;">gnp</td>
<td style="text-align: left;">gnpLag</td>
<td style="text-align: left;">trend</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Est.2SLS</td>
<td style="text-align: left;">16.555</td>
<td style="text-align: left;">0.017</td>
<td style="text-align: left;">0.216</td>
<td style="text-align: left;">0.810</td>
<td style="text-align: left;">20.278</td>
<td style="text-align: left;">0.150</td>
<td style="text-align: left;">0.616</td>
<td style="text-align: left;">-0.158</td>
<td style="text-align: left;">1.500</td>
<td style="text-align: left;">0.439</td>
<td style="text-align: left;">0.147</td>
<td style="text-align: left;">0.130</td>
</tr>
<tr class="even">
<td style="text-align: left;">SE.2SLS</td>
<td style="text-align: left;">1.321</td>
<td style="text-align: left;">0.118</td>
<td style="text-align: left;">0.107</td>
<td style="text-align: left;">0.040</td>
<td style="text-align: left;">7.543</td>
<td style="text-align: left;">0.173</td>
<td style="text-align: left;">0.163</td>
<td style="text-align: left;">0.036</td>
<td style="text-align: left;">1.148</td>
<td style="text-align: left;">0.036</td>
<td style="text-align: left;">0.039</td>
<td style="text-align: left;">0.029</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Est.3SLS</td>
<td style="text-align: left;">16.441</td>
<td style="text-align: left;">0.125</td>
<td style="text-align: left;">0.163</td>
<td style="text-align: left;">0.790</td>
<td style="text-align: left;">28.178</td>
<td style="text-align: left;">-0.013</td>
<td style="text-align: left;">0.756</td>
<td style="text-align: left;">-0.195</td>
<td style="text-align: left;">1.797</td>
<td style="text-align: left;">0.400</td>
<td style="text-align: left;">0.181</td>
<td style="text-align: left;">0.150</td>
</tr>
<tr class="even">
<td style="text-align: left;">SE.3SLS</td>
<td style="text-align: left;">1.305</td>
<td style="text-align: left;">0.108</td>
<td style="text-align: left;">0.100</td>
<td style="text-align: left;">0.038</td>
<td style="text-align: left;">6.794</td>
<td style="text-align: left;">0.162</td>
<td style="text-align: left;">0.153</td>
<td style="text-align: left;">0.033</td>
<td style="text-align: left;">1.116</td>
<td style="text-align: left;">0.032</td>
<td style="text-align: left;">0.034</td>
<td style="text-align: left;">0.028</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Est.SUR</td>
<td style="text-align: left;">15.981</td>
<td style="text-align: left;">0.230</td>
<td style="text-align: left;">0.067</td>
<td style="text-align: left;">0.796</td>
<td style="text-align: left;">12.929</td>
<td style="text-align: left;">0.443</td>
<td style="text-align: left;">0.365</td>
<td style="text-align: left;">-0.125</td>
<td style="text-align: left;">1.635</td>
<td style="text-align: left;">0.410</td>
<td style="text-align: left;">0.174</td>
<td style="text-align: left;">0.156</td>
</tr>
<tr class="even">
<td style="text-align: left;">SE.SUR</td>
<td style="text-align: left;">1.169</td>
<td style="text-align: left;">0.077</td>
<td style="text-align: left;">0.077</td>
<td style="text-align: left;">0.035</td>
<td style="text-align: left;">4.801</td>
<td style="text-align: left;">0.086</td>
<td style="text-align: left;">0.089</td>
<td style="text-align: left;">0.023</td>
<td style="text-align: left;">1.117</td>
<td style="text-align: left;">0.027</td>
<td style="text-align: left;">0.031</td>
<td style="text-align: left;">0.028</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Est.OLS</td>
<td style="text-align: left;">16.237</td>
<td style="text-align: left;">0.193</td>
<td style="text-align: left;">0.090</td>
<td style="text-align: left;">0.796</td>
<td style="text-align: left;">10.126</td>
<td style="text-align: left;">0.480</td>
<td style="text-align: left;">0.333</td>
<td style="text-align: left;">-0.112</td>
<td style="text-align: left;">1.497</td>
<td style="text-align: left;">0.439</td>
<td style="text-align: left;">0.146</td>
<td style="text-align: left;">0.130</td>
</tr>
<tr class="even">
<td style="text-align: left;">SE.OLS</td>
<td style="text-align: left;">1.172</td>
<td style="text-align: left;">0.082</td>
<td style="text-align: left;">0.082</td>
<td style="text-align: left;">0.036</td>
<td style="text-align: left;">4.918</td>
<td style="text-align: left;">0.087</td>
<td style="text-align: left;">0.091</td>
<td style="text-align: left;">0.024</td>
<td style="text-align: left;">1.143</td>
<td style="text-align: left;">0.029</td>
<td style="text-align: left;">0.034</td>
<td style="text-align: left;">0.029</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img1.png" class="img-fluid figure-img" width="600"></p>
<figcaption>Klein’s Model I Comparison from Greene Textbook</figcaption>
</figure>
</div>
</section>
<section id="takeaways" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="takeaways"><span class="header-section-number">5</span> Takeaways</h2>
<p><strong>Key insights from comparing estimation methods:</strong></p>
<ol type="1">
<li><p><strong>GLS-based estimators</strong> (SUR and 3SLS) generally produce smaller standard errors compared to their OLS/2SLS counterparts, suggesting efficiency gains from accounting for cross-equation correlation.</p></li>
<li><p><strong>Misspecification risk:</strong> While GLS methods are more efficient, misspecification of any equation contaminates the entire system. With OLS/2SLS, misspecification is confined to individual equations.</p></li>
<li><p><strong>Small sample properties:</strong> The FGLS estimator’s behavior in small samples is unknown—it may or may not be unbiased. Asymptotic properties hold only if <span class="math inline">\(\hat{\Omega}\)</span> is a consistent estimator of <span class="math inline">\(\Omega\)</span>.</p></li>
<li><p><strong>Trade-off:</strong> Choose between:</p>
<ul>
<li><strong>Robustness</strong> (OLS/2SLS): Less efficient but more robust to specification errors</li>
<li><strong>Efficiency</strong> (SUR/3SLS): More efficient but requires correct specification of all equations</li>
</ul></li>
<li><p><strong>Instrument validity:</strong> When using 2SLS/3SLS with over-identified equations, always test overidentifying restrictions (e.g., Sargan test). This verifies whether excluded instruments are truly exogenous. Rejection suggests instruments may be invalid and estimates could be biased.</p></li>
<li><p><strong>Weak instruments problem:</strong> Even if instruments are valid (exogenous), they must also be relevant (strong first stage). Weak instruments (F &lt; 10) can lead to:</p>
<ul>
<li>Biased estimates in finite samples</li>
<li>Imprecise inference (large standard errors)</li>
<li>Invalid asymptotic approximations</li>
<li>Tests losing power</li>
</ul></li>
</ol>
<p><strong>When to use each method:</strong></p>
<ul>
<li><strong>OLS:</strong> No endogeneity, no cross-equation correlation</li>
<li><strong>2SLS:</strong> Endogeneity present, no cross-equation correlation<br>
</li>
<li><strong>SUR:</strong> No endogeneity, cross-equation correlation present</li>
<li><strong>3SLS:</strong> Both endogeneity and cross-equation correlation present</li>
</ul>
<p><strong>Best practices for IV estimation:</strong></p>
<ol type="1">
<li><strong>Check identification</strong> using order condition before estimation</li>
<li><strong>Test for endogeneity</strong> (Wu-Hausman test) to confirm IV is needed</li>
<li><strong>Check instrument strength</strong> (first-stage F-test, rule of thumb: F &gt; 10)</li>
<li><strong>Test instrument validity</strong> with overidentification tests when possible (Sargan/Hansen tests)</li>
<li><strong>Use weak-instrument-robust methods</strong> if F &lt; 10 (e.g., Anderson-Rubin test, conditional LR test)</li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>